<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Placement Algorithm Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .grid-demo {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            height: 300px;
            border: 2px solid #333;
            margin: 20px 0;
        }
        .demo-container {
            background: #f8f9fa;
            border: 2px solid #007bff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #007bff;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ðŸ§  Smart Best-Fit Placement Algorithm Test</h1>
    
    <div class="test-section">
        <h2>Algorithm Demo</h2>
        <p>This demonstrates the Smart Best-Fit with Reorganization algorithm in action.</p>
        
        <button class="test-button" onclick="testScenario1()">Scenario 1: Progressive Addition</button>
        <button class="test-button" onclick="testScenario2()">Scenario 2: Content-Type Aware</button>
        <button class="test-button" onclick="testScenario3()">Scenario 3: Reorganization</button>
        <button class="test-button" onclick="clearDemo()">Clear</button>
        
        <div class="grid-demo" id="demoGrid"></div>
        
        <h3>Algorithm Log</h3>
        <div class="log" id="algorithmLog"></div>
    </div>

    <script>
        // Mock Smart Placement Engine for demonstration
        class DemoSmartPlacementEngine {
            constructor() {
                this.gridSize = 3;
                this.totalCells = 9;
                this.containers = [];
            }

            log(message) {
                const logElement = document.getElementById('algorithmLog');
                logElement.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
                logElement.scrollTop = logElement.scrollHeight;
            }

            addContainer(config) {
                this.log(`ðŸ” Adding container: ${config.title} (${config.contentType})`);
                
                // Simulate algorithm thinking
                const currentOccupancy = this.containers.length / this.totalCells;
                this.log(`ðŸ“Š Current grid occupancy: ${(currentOccupancy * 100).toFixed(1)}%`);
                
                // Determine size based on content type
                const size = this.determineOptimalSize(config.contentType);
                this.log(`ðŸ“ Optimal size for ${config.contentType}: ${size.width}x${size.height}`);
                
                // Check if reorganization is needed
                const needsReorganization = this.containers.length > 0 && 
                    this.wouldRequireReorganization(size);
                
                if (needsReorganization) {
                    this.log(`ðŸ”„ Reorganization needed - current layout cannot accommodate new container`);
                    this.performReorganization(config, size);
                } else {
                    this.log(`âœ… Normal placement - found suitable space`);
                    this.normalPlacement(config, size);
                }
                
                this.renderGrid();
            }

            determineOptimalSize(contentType) {
                const sizeMap = {
                    'line_chart': { width: 2, height: 1 },
                    'bar_chart': { width: 1, height: 2 },
                    'kpi_card': { width: 1, height: 1 },
                    'scatter_plot': { width: 2, height: 2 },
                    'data_table': { width: 1, height: 2 },
                    'generic': { width: 1, height: 1 }
                };
                return sizeMap[contentType] || sizeMap['generic'];
            }

            wouldRequireReorganization(newSize) {
                // Simple check: if we have containers and new size is large
                return this.containers.length > 0 && (newSize.width > 1 || newSize.height > 1);
            }

            normalPlacement(config, size) {
                const position = this.findBestPosition(size);
                this.containers.push({
                    ...config,
                    ...size,
                    ...position,
                    id: `container_${this.containers.length + 1}`
                });
                this.log(`ðŸ“ Placed at position (${position.row}, ${position.col})`);
            }

            performReorganization(config, size) {
                this.log(`ðŸ§® Generating all possible layouts...`);
                
                // Simulate reorganization algorithm
                const totalContainers = this.containers.length + 1;
                this.log(`ðŸ“‹ Need to fit ${totalContainers} containers in ${this.totalCells} cells`);
                
                // Mock reorganization - resize existing containers
                this.containers.forEach((container, index) => {
                    const newSize = { width: 1, height: 1 }; // Shrink to make room
                    container.width = newSize.width;
                    container.height = newSize.height;
                    this.log(`ðŸ“¦ Resized "${container.title}" to ${newSize.width}x${newSize.height}`);
                });

                // Add new container
                this.containers.push({
                    ...config,
                    ...size,
                    row: 0,
                    col: 0,
                    id: `container_${this.containers.length + 1}`
                });

                // Rearrange all containers
                this.rearrangeContainers();
                this.log(`âœ¨ Reorganization complete - optimal layout achieved`);
            }

            rearrangeContainers() {
                let currentRow = 0;
                let currentCol = 0;

                this.containers.forEach(container => {
                    container.row = currentRow;
                    container.col = currentCol;
                    
                    currentCol += container.width;
                    if (currentCol >= this.gridSize) {
                        currentCol = 0;
                        currentRow += container.height;
                    }
                });
            }

            findBestPosition(size) {
                // Simple first-fit algorithm for demo
                for (let row = 0; row <= this.gridSize - size.height; row++) {
                    for (let col = 0; col <= this.gridSize - size.width; col++) {
                        if (this.isPositionFree(row, col, size)) {
                            return { row, col };
                        }
                    }
                }
                return { row: 0, col: 0 }; // Fallback
            }

            isPositionFree(row, col, size) {
                // Check if position is free (simplified)
                return this.containers.length === 0; // For demo simplicity
            }

            renderGrid() {
                const grid = document.getElementById('demoGrid');
                grid.innerHTML = '';

                // Create grid cells
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.style.gridArea = `${Math.floor(i/3) + 1} / ${(i%3) + 1}`;
                    cell.style.background = '#f8f9fa';
                    cell.style.border = '1px dashed #ccc';
                    grid.appendChild(cell);
                }

                // Add containers
                this.containers.forEach(container => {
                    const containerElement = document.createElement('div');
                    containerElement.className = 'demo-container';
                    containerElement.textContent = container.title;
                    containerElement.style.gridArea = 
                        `${container.row + 1} / ${container.col + 1} / 
                         ${container.row + container.height + 1} / ${container.col + container.width + 1}`;
                    grid.appendChild(containerElement);
                });

                this.log(`ðŸŽ¨ Grid rendered with ${this.containers.length} containers`);
            }

            clear() {
                this.containers = [];
                this.renderGrid();
                this.log(`ðŸ§¹ Grid cleared`);
            }
        }

        // Initialize demo engine
        const demoEngine = new DemoSmartPlacementEngine();

        function testScenario1() {
            demoEngine.clear();
            demoEngine.log(`ðŸš€ Starting Scenario 1: Progressive Addition`);
            
            setTimeout(() => demoEngine.addContainer({ title: 'Chart 1', contentType: 'line_chart' }), 500);
            setTimeout(() => demoEngine.addContainer({ title: 'KPI', contentType: 'kpi_card' }), 1500);
            setTimeout(() => demoEngine.addContainer({ title: 'Chart 2', contentType: 'bar_chart' }), 2500);
        }

        function testScenario2() {
            demoEngine.clear();
            demoEngine.log(`ðŸŽ¯ Starting Scenario 2: Content-Type Aware Sizing`);
            
            setTimeout(() => demoEngine.addContainer({ title: 'Scatter Plot', contentType: 'scatter_plot' }), 500);
            setTimeout(() => demoEngine.addContainer({ title: 'Data Table', contentType: 'data_table' }), 1500);
        }

        function testScenario3() {
            demoEngine.clear();
            demoEngine.log(`ðŸ”„ Starting Scenario 3: Reorganization Demo`);
            
            // Add a large container first
            setTimeout(() => demoEngine.addContainer({ title: 'Big Chart', contentType: 'scatter_plot' }), 500);
            // Then add smaller ones that force reorganization
            setTimeout(() => demoEngine.addContainer({ title: 'KPI 1', contentType: 'kpi_card' }), 1500);
            setTimeout(() => demoEngine.addContainer({ title: 'KPI 2', contentType: 'kpi_card' }), 2500);
            setTimeout(() => demoEngine.addContainer({ title: 'Table', contentType: 'data_table' }), 3500);
        }

        function clearDemo() {
            demoEngine.clear();
        }

        // Initialize
        demoEngine.log(`ðŸŽ‰ Smart Placement Algorithm Demo Ready!`);
        demoEngine.log(`Click the buttons above to see different scenarios`);
    </script>
</body>
</html> 